<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Runner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;background:#6ec6ff;}
canvas{display:block;margin:auto;background:#b3e5fc;}
</style>
</head>

<body>
<canvas id="game" width="360" height="640"></canvas>

<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");

/* ===== PLAYER ===== */
let px = 80;
let py = 480;
let vy = 0;
let grounded = true;
const gravity = 1;
const jump = -18;

/* ===== GROUND ===== */
const groundY = 520;
let grassX = 0;

/* ===== OBSTACLES ===== */
let obstacles = [];
const gap = 220;

/* ===== STATE ===== */
let speed = 4;
let started = false;
let gameOver = false;

/* ===== SPEECH ===== */
let speechUnlocked = false;
let chantInterval = null;

function speak(text){
  if(!speechUnlocked) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "hi-IN";
  speechSynthesis.speak(u);
}

function startChant(){
  if(chantInterval) return;
  chantInterval = setInterval(()=>{
    if(!gameOver){
      speak("‡§Ö‡§Ç‡§ï‡§ø‡§§ ‡§Ö‡§Ç‡§ï‡§ø‡§§");
    }
  }, 2000);
}

function stopChant(){
  clearInterval(chantInterval);
  chantInterval = null;
}

/* ===== OBSTACLE ===== */
function makeObstacle(x){
  return { x:x, w:40, h:60+Math.random()*40 };
}

/* ===== RESET ===== */
function reset(){
  py = 480;
  vy = 0;
  grounded = true;
  obstacles = [];
  for(let i=1;i<=5;i++){
    obstacles.push(makeObstacle(i*gap+300));
  }
  started = false;
  gameOver = false;
  stopChant();
}

/* ===== INPUT ===== */
c.addEventListener("touchstart", tap);
c.addEventListener("click", tap);

function tap(){
  speechUnlocked = true; // unlock audio

  if(!started){
    started = true;
    startChant();
    return;
  }

  if(gameOver){
    reset();
    return;
  }

  if(grounded){
    vy = jump;
    grounded = false;
  }
}

/* ===== UPDATE ===== */
function update(){
  if(!started || gameOver) return;

  // physics
  vy += gravity;
  py += vy;

  if(py >= 480){
    py = 480;
    vy = 0;
    grounded = true;
  }

  // grass
  grassX -= speed;
  if(grassX <= -40) grassX = 0;

  // obstacles
  obstacles.forEach(o => o.x -= speed);

  if(obstacles[0].x + obstacles[0].w < 0){
    obstacles.shift();
    obstacles.push(makeObstacle(obstacles[obstacles.length-1].x + gap));
  }

  // collision
  obstacles.forEach(o=>{
    if(
      px + 30 > o.x &&
      px < o.x + o.w &&
      py + 30 > groundY - o.h
    ){
      gameOver = true;
      stopChant();
      speak("‡§ï‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§à‡§Ø‡§æ, ‡§õ‡•Ä ‡§õ‡•Ä ‡§õ‡•Ä");
    }
  });
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,c.width,c.height);

  // grass
  for(let i=0;i<10;i++){
    ctx.fillStyle="#2e7d32";
    ctx.fillRect(i*40+grassX, groundY, 40, 120);
    ctx.fillStyle="#66bb6a";
    ctx.fillRect(i*40+grassX, groundY, 40, 6);
  }

  // obstacles
  ctx.fillStyle="#8d6e63";
  obstacles.forEach(o=>{
    ctx.fillRect(o.x, groundY-o.h, o.w, o.h);
  });

  // player
  ctx.font="36px serif";
  ctx.fillText("üòà", px, py+32);

  // UI
  ctx.fillStyle="#000";
  ctx.font="18px Arial";
  if(!started) ctx.fillText("TAP TO START",100,300);

  if(gameOver){
    ctx.fillStyle="red";
    ctx.fillRect(80,300,200,60);
    ctx.fillStyle="#fff";
    ctx.fillText("RESTART",130,340);
  }
}

/* ===== LOOP ===== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

reset();
loop();
</script>
</body>
</html>
